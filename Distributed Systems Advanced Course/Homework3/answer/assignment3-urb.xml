<?xml version="1.0" encoding="UTF-8"?>
<tns:configuration xmlns:tns="http://www.sics.se/adl">
    <tns:factories>
        <tns:factory>
            <tns:factoryName>RbApplicationComponentFactory</tns:factoryName>
            <tns:componentClass>assignment3.components.RbApplicationComponent</tns:componentClass>
        </tns:factory>
        <tns:factory>
            <tns:factoryName>UrbBroadcastComponentFactory</tns:factoryName>
            <tns:componentClass>assignment3.components.UniformReliableBroadcastComponent</tns:componentClass>
        </tns:factory>
        <tns:factory>
            <tns:factoryName>BebBroadcastComponentFactory</tns:factoryName>
            <tns:componentClass>assignment3.components.BestEffortBroadcastComponent</tns:componentClass>
        </tns:factory>
        <tns:factory>
            <tns:factoryName>DelayComponentFactory</tns:factoryName>
            <tns:componentClass>assignment3.components.DelayComponent</tns:componentClass>
        </tns:factory>
        <tns:factory>
            <tns:factoryName>CommunicationComponentFactory</tns:factoryName>
            <tns:componentClass>tbn.comm.mina.CommunicationComponent</tns:componentClass>
        </tns:factory>
        <tns:factory>
            <tns:factoryName>TimerComponentFactory</tns:factoryName>
            <tns:componentClass>tbn.timer.TimerComponent</tns:componentClass>
        </tns:factory>
        <tns:factory>
            <tns:factoryName>PerfectFailureDetectorComponentFactory</tns:factoryName>
            <tns:componentClass>assignment3.components.PerfectFailureDetectorComponent</tns:componentClass>
        </tns:factory>
    </tns:factories>
    <!---->
    <tns:components>
        <tns:component>
            <tns:factoryName>RbApplicationComponentFactory</tns:factoryName>
            <tns:componentName>RbApplicationComponent</tns:componentName>
        </tns:component>
        <tns:component>
            <tns:factoryName>DelayComponentFactory</tns:factoryName>
            <tns:componentName>DelayComponent</tns:componentName>
        </tns:component>
        <tns:component>
            <tns:factoryName>CommunicationComponentFactory</tns:factoryName>
            <tns:componentName>CommunicationComponent</tns:componentName>
        </tns:component>
        <tns:component>
            <tns:factoryName>PerfectFailureDetectorComponentFactory</tns:factoryName>
            <tns:componentName>PerfectFailureDetectorComponent</tns:componentName>
            <tns:initFile>pfd.properties</tns:initFile>
        </tns:component>
        <tns:component>
            <tns:factoryName>TimerComponentFactory</tns:factoryName>
            <tns:componentName>TimerComponent</tns:componentName>
        </tns:component>
        <tns:component>
            <tns:factoryName>BebBroadcastComponentFactory</tns:factoryName>
            <tns:componentName>BebBroadcastComponent</tns:componentName>
        </tns:component>
        <tns:component>
            <tns:factoryName>UrbBroadcastComponentFactory</tns:factoryName>
            <tns:componentName>UrbBroadcastComponent</tns:componentName>
        </tns:component>
    </tns:components>
    <!---->
    <tns:channels>
        <!---->
        <tns:channel>
            <tns:channelName>RbApplicationComponentInputChannel</tns:channelName>
            <tns:eventClass>assignment3.events.RbDeliverEvent</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>InitEventChannel</tns:channelName>
            <tns:eventClass>assignment3.events.InitEvent</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
            <tns:eventClass>assignment3.events.DelayTimerExpiredEvent</tns:eventClass>
            <tns:eventClass>tbn.comm.mina.events.MessageEvent</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>CommunicationComponentInputChannel</tns:channelName>
            <tns:eventClass>tbn.comm.mina.events.MessageEvent</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
            <tns:eventClass>assignment3.events.HeartbeatTimeOutEvent</tns:eventClass>
            <tns:eventClass>assignment3.events.CheckTimeOutEvent</tns:eventClass>
            <tns:eventClass>assignment3.events.HeartbeatMessage</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>TimerEventChannel</tns:channelName>
            <tns:eventClass>tbn.timer.events.TimerEvent</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
            <tns:eventClass>assignment3.events.BebDeliverEvent</tns:eventClass>
            <tns:eventClass>assignment3.events.CrashEvent</tns:eventClass>
            <tns:eventClass>assignment3.events.RbBroadcastEvent</tns:eventClass>
        </tns:channel>
        <tns:channel>
            <tns:channelName>BebBroadcastComponentInputChannel</tns:channelName>
            <tns:eventClass>assignment3.events.BroadcastMessage</tns:eventClass>
            <tns:eventClass>assignment3.events.BebBroadcastEvent</tns:eventClass>
        </tns:channel>

    </tns:channels>
    <!--bind component's output event to channel-->
    <tns:bindings>
        <!---->
        <tns:binding>
            <tns:componentName>RbApplicationComponentFactory:RbApplicationComponent</tns:componentName>
            <tns:eventClass>assignment3.events.InitEvent</tns:eventClass>
            <tns:channelName>InitEventChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>RbApplicationComponentFactory:RbApplicationComponent</tns:componentName>
            <tns:eventClass>assignment3.events.RbBroadcastEvent</tns:eventClass>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>BebBroadcastComponentFactory:BebBroadcastComponent</tns:componentName>
            <tns:eventClass>tbn.comm.mina.events.MessageEvent</tns:eventClass>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>BebBroadcastComponentFactory:BebBroadcastComponent</tns:componentName>
            <tns:eventClass>assignment3.events.BebDeliverEvent</tns:eventClass>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>DelayComponentFactory:DelayComponent</tns:componentName>
            <tns:eventClass>tbn.comm.mina.events.MessageEvent</tns:eventClass>
            <tns:channelName>CommunicationComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>DelayComponentFactory:DelayComponent</tns:componentName>
            <tns:eventClass>tbn.timer.events.TimerEvent</tns:eventClass>
            <tns:channelName>TimerEventChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>CommunicationComponentFactory:CommunicationComponent</tns:componentName>
            <tns:eventClass>assignment3.events.HeartbeatMessage</tns:eventClass>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>CommunicationComponentFactory:CommunicationComponent</tns:componentName>
            <tns:eventClass>assignment3.events.BroadcastMessage</tns:eventClass>
            <tns:channelName>BebBroadcastComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent
            </tns:componentName>
            <tns:eventClass>tbn.comm.mina.events.MessageEvent</tns:eventClass>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent
            </tns:componentName>
            <tns:eventClass>tbn.timer.events.TimerEvent</tns:eventClass>
            <tns:channelName>TimerEventChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent
            </tns:componentName>
            <tns:eventClass>assignment3.events.CrashEvent</tns:eventClass>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>TimerComponentFactory:TimerComponent</tns:componentName>
            <tns:eventClass>assignment3.events.DelayTimerExpiredEvent</tns:eventClass>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>TimerComponentFactory:TimerComponent</tns:componentName>
            <tns:eventClass>assignment3.events.CheckTimeOutEvent</tns:eventClass>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>TimerComponentFactory:TimerComponent</tns:componentName>
            <tns:eventClass>assignment3.events.HeartbeatTimeOutEvent</tns:eventClass>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:eventClass>assignment3.events.RbDeliverEvent</tns:eventClass>
            <tns:channelName>RbApplicationComponentInputChannel</tns:channelName>
        </tns:binding>
        <tns:binding>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:eventClass>assignment3.events.BebBroadcastEvent</tns:eventClass>
            <tns:channelName>BebBroadcastComponentInputChannel</tns:channelName>
        </tns:binding>
    </tns:bindings>

    <!--subscribe a channel to listen and with the component's handler to handle the incoming messages-->
    <tns:subscriptions>
        <!---->
        <tns:subscription>
            <tns:componentName>RbApplicationComponentFactory:RbApplicationComponent</tns:componentName>
            <tns:channelName>RbApplicationComponentInputChannel</tns:channelName>
            <tns:handlerName>handleRbDeliverEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>BebBroadcastComponentFactory:BebBroadcastComponent</tns:componentName>
            <tns:channelName>InitEventChannel</tns:channelName>
            <tns:handlerName>handleInitEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>BebBroadcastComponentFactory:BebBroadcastComponent</tns:componentName>
            <tns:channelName>BebBroadcastComponentInputChannel</tns:channelName>
            <tns:handlerName>handleBroadcastMessage</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>BebBroadcastComponentFactory:BebBroadcastComponent</tns:componentName>
            <tns:channelName>BebBroadcastComponentInputChannel</tns:channelName>
            <tns:handlerName>handleBebBroadcastEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>DelayComponentFactory:DelayComponent</tns:componentName>
            <tns:channelName>InitEventChannel</tns:channelName>
            <tns:handlerName>handleInitEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>DelayComponentFactory:DelayComponent</tns:componentName>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
            <tns:handlerName>handleDelayTimerExpiredEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>DelayComponentFactory:DelayComponent</tns:componentName>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
            <tns:handlerName>handleMessageEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>CommunicationComponentFactory:CommunicationComponent</tns:componentName>
            <tns:channelName>CommunicationComponentInputChannel</tns:channelName>
            <!--TODO handleMessageEvent ?-->
            <tns:handlerName>handleSendEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent</tns:componentName>
            <tns:channelName>InitEventChannel</tns:channelName>
            <tns:handlerName>handleInitEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent</tns:componentName>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
            <tns:handlerName>handleHeartbeatTimeOutEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent</tns:componentName>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
            <tns:handlerName>handleCheckTimeOutEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent</tns:componentName>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
            <tns:handlerName>handleHeartbeatMessage</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>TimerComponentFactory:TimerComponent</tns:componentName>
            <tns:channelName>TimerEventChannel</tns:channelName>
            <tns:handlerName>handleTimerEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:channelName>InitEventChannel</tns:channelName>
            <tns:handlerName>handleInitEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
            <tns:handlerName>handleBebDeliverEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
            <tns:handlerName>handleCrashEvent</tns:handlerName>
        </tns:subscription>
        <tns:subscription>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
            <tns:handlerName>handleRbBroadcastEvent</tns:handlerName>
        </tns:subscription>

    </tns:subscriptions>
    <!--//////////////////////////////////////////////////////////////////////////-->
    <!--////////////////remember to start the initial component last//////////////-->
    <!--//////////////////////////////////////////////////////////////////////////-->
    <tns:startSequence>
        <tns:startComponents>
            <tns:componentName>UrbBroadcastComponentFactory:UrbBroadcastComponent</tns:componentName>
            <tns:componentName>BebBroadcastComponentFactory:BebBroadcastComponent</tns:componentName>
            <tns:componentName>TimerComponentFactory:TimerComponent</tns:componentName>
            <tns:componentName>PerfectFailureDetectorComponentFactory:PerfectFailureDetectorComponent
            </tns:componentName>
            <tns:componentName>CommunicationComponentFactory:CommunicationComponent</tns:componentName>
            <tns:componentName>DelayComponentFactory:DelayComponent</tns:componentName>
            <tns:componentName>RbApplicationComponentFactory:RbApplicationComponent</tns:componentName>
        </tns:startComponents>
        <tns:startChannels>
            <tns:channelName>RbApplicationComponentInputChannel</tns:channelName>
            <tns:channelName>InitEventChannel</tns:channelName>
            <tns:channelName>DelayComponentInputChannel</tns:channelName>
            <tns:channelName>CommunicationComponentInputChannel</tns:channelName>
            <tns:channelName>PerfectFailureDetectorComponentInputChannel</tns:channelName>
            <tns:channelName>TimerEventChannel</tns:channelName>
            <tns:channelName>UrbBroadcastComponentInputChannel</tns:channelName>
            <tns:channelName>BebBroadcastComponentInputChannel</tns:channelName>

        </tns:startChannels>
    </tns:startSequence>
</tns:configuration>

